<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>カート</title>
    <link rel="stylesheet" href="/css/global.css">
    <link rel="stylesheet" href="/css/home.css">
    <link rel="stylesheet" href="/css/category.css">
    <link rel="stylesheet" href="/css/output.css">
    <link rel="stylesheet" href="/themify-icons/themify-icons.css">
    <script src="https://cdn.tailwindcss.com"></script>
</head>

<body class="bg-gray-100 min-h-screen">

    <%- include('../partials/header.ejs') %>

        <main class="container mx-auto px-20 py-10 grid grid-cols-1 md:grid-cols-[65%_30%] gap-16">
            <div id="cartItems" class="bg-white shadow-xl rounded-2xl p-6 md:p-8 space-y-6 border border-gray-100">
                <% if (!cart || cart.items.length===0) { %>
                    <p class="text-center text-gray-400 text-xl font-medium py-12">カートは空です</p>
                    <% } else { %>
                        <div class="flex items-center justify-between mb-4">
                            <label class="flex items-center gap-2">
                                <input type="checkbox" id="checkAll" class="w-5 h-5 accent-[var(--primary-color)]">
                                <span class="text-gray-700 font-medium">Select All</span>
                            </label>
                            <button id="removeSelected" onclick="setTimeout(() => {
                                location.reload();
                                },300);"
                                class="bg-black hover:bg-red-700 text-white px-4 py-2 rounded-lg shadow text-sm">
                                Remove All
                            </button>
                        </div>
                          <div class="text-[var(--primary-color)] text-3xl mb-2">
                            <span>Total:</span>
                            <span><%= cart && cart.items ? cart.items.reduce((sum, item) => sum + item.quantity, 0) : 0 %> 個</span>
                        </div>
                        <% cart.items.forEach((item, idx)=> { %>
                            <div
                                class="item-container flex flex-col md:flex-row justify-between items-center border-b last:border-b-0 pb-6 md:pb-4 bg-white rounded-xl shadow hover:shadow-lg transition-all duration-200 px-2 md:px-0">
                                <div class=" flex items-center gap-4 w-full md:w-auto px-12">
                                    <!-- Checkbox chọn sản phẩm -->
                                    <input type="checkbox" class="item-check w-5 h-5 accent-[var(--primary-color)]">
                                    <div class="m-0 p-0 w-[100px] h-[100px] md:w-[130px] md:h-[130px] object-cover rounded-xl overflow-hidden product-link bg-gray-100 border border-gray-200 shadow-sm"
                                        style="cursor:pointer;"
                                        onclick="window.location.href='/productDetail/<%= item.productId %>'">
                                        <img src="<%= item.images && item.images[0] 
          ? (item.images[0].startsWith('/images/product/') ? item.images[0] : '/images/product/' + item.images[0]) 
          : '/images/product/no-img.png' %>" alt="<%= item.name %>"
                                            class="product-img w-full h-full object-cover cursor-pointer transition-transform duration-200 hover:scale-105">
                                    </div>
                                    <div class="flex flex-col gap-1">
                                        <h2
                                            class="item-name text-base md:text-lg font-semibold text-gray-900 truncate max-w-[160px] md:max-w-[180px]">
                                            <%= item.name %>
                                        </h2>
                                        <p class="text-gray-500 text-xs md:text-sm">サイズ: <span
                                                class="font-medium text-gray-700">
                                                <%= item.size || '-' %>
                                            </span>
                                        </p>
                                        <p class="text-gray-500 text-xs md:text-sm">数量: <span
                                                class="qtt font-medium text-gray-700">
                                                <%= item.quantity %>
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                <div class="flex flex-row md:flex-col items-end gap-2 mt-4 md:mt-0 px-12">
                                    <span class="cartTotal text-base md:text-lg font-bold text-[var(--primary-color)]">
                                        <%= (item.price * item.quantity).toLocaleString() %>¥
                                    </span>
                                    <button onclick='removeFromCart("<%= item.productId %>", "<%= item.size %>")'
                                        class="remove-item-btn bg-black hover:bg-red-600 text-white px-3 py-1 rounded-lg shadow-sm transition font-medium text-xs md:text-sm">
                                        消去
                                    </button>
                                </div>
                            </div>
                            <% }) %>
                                <% } %>
            </div>
            <div
                class="cart-check bg-white shadow-xl rounded-2xl p-6 md:p-8 flex flex-col gap-8 border border-gray-100 h-fit sticky top-8">
                <div class="cart-sum">
                    <div id="cartTotal" class="text-right text-2xl font-bold">
                        <h3 class="text-left">Order Summary</h3>
                        <div class="flex justify-between text-[var(--primary-color)]">
                            <p>合計:</p>
                            <p>
                                <%= cart ? cart.total.toLocaleString() : 0 %>¥
                            </p>
                        </div>
                    </div>
                    <div class="mt-8 flex justify-end">
                        <button id="checkout-Btn"
                            class="w-full bg-gradient-to-r from-green-400 to-green-600 hover:from-green-500 hover:to-green-700 text-white px-8 py-3 rounded-xl font-semibold shadow-lg transition-all duration-200 text-lg">
                            チェックアウト
                        </button>
                    </div>
                </div>
                <div
                    class="pay-method flex gap-2 justify-center border-t border-gray-200 pt-6 bg-gray-50 rounded-xl shadow-inner">
                    <img src="/images/payment/visa.webp" alt="Payment Methods" class="h-10 drop-shadow-md">
                    <img src="/images/payment/paypay.webp" alt="Payment Methods" class="h-10 drop-shadow-md">
                    <img src="/images/payment/jcb.webp" alt="Payment Methods" class="h-10 drop-shadow-md">
                    <img src="/images/payment/paidy.webp" alt="Payment Methods" class="h-10 drop-shadow-md">
                </div>
            </div>
        </main>
        <div id="toast"
            class="fixed bottom-4 right-4 bg-black text-white px-4 py-2 rounded-lg shadow-lg opacity-0 translate-x-full transition-all duration-300">
        </div>
</body>
<script src="/js/cart.js"></script>
<script src="/js/auth.js"></script>
<script src="/js/cart-page.js"></script>

</html>